<div class="card card-glossy shadow-lg mb-4">
    <div class="card-header card-header-professional">
        <h3 class="h6 mb-0"><i class="bi bi-person-workspace me-2"></i> SKU History & Status Teknisi</h3>
    </div>

    <div class="p-2 bg-light border-bottom">
        <div class="input-group input-group-sm">
            <span class="input-group-text bg-white border-end-0"><i class="bi bi-search"></i></span>
            <input type="text" id="skuSearchInput" class="form-control border-start-0" placeholder="Cari SKU ID..." autocomplete="off">
        </div>
    </div>

    <div class="card-body p-0">
        <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
            <table class="table table-hover table-sm mb-0">
                <thead class="table-primary sticky-top" style="z-index: 10;">
                    <tr>
                        <th>SKU ID</th>
                        <th>Teknisi</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="skuTableBody">
                    {% for sku in sidebar_skus_under_tech %}
                    <tr class="sku-row">
                        <td class="align-middle">
                            <a href="#"
                               class="text-decoration-none fw-bold text-dark sku-id-text"
                               data-bs-toggle="modal"
                               data-bs-target="#skuHistoryModal"
                               data-sku-id="{{ sku.id }}">
                                {{ sku.sku_id }}
                            </a>
                        </td>
                        <td class="align-middle small text-muted">{{ sku.assigned_technician.username }}</td>
                        <td class="align-middle">
                            <span class="badge py-2 px-3 fw-bold
                                {% if sku.status == 'QC' %} bg-warning text-dark
                                {% elif sku.status == 'QC_PENDING' %} bg-info text-dark
                                {% elif sku.status == 'AWAITING_INSTALL' %} bg-primary
                                {% elif sku.status == 'PENDING_FINAL_CHECK' %} bg-danger
                                {% else %} bg-secondary {% endif %}">
                                {% if sku.status == 'QC' %} <i class="bi bi-tools me-1"></i> QC
                                {% elif sku.status == 'QC_PENDING' %} <i class="bi bi-hourglass-split me-1"></i> QC Pending
                                {% elif sku.status == 'AWAITING_INSTALL' %} <i class="bi bi-truck me-1"></i> Tunggu Instalasi
                                {% elif sku.status == 'PENDING_FINAL_CHECK' %} <i class="bi bi-exclamation-triangle me-1"></i> Cek Final
                                {% else %} {{ sku.get_status_display }} {% endif %}
                            </span>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3" class="text-center text-muted p-3">
                            <i class="bi bi-info-circle me-1"></i> Tidak ada SKU yang sedang diproses.
                        </td>
                    </tr>
                    {% endfor %}
                    <tr id="noSearchMatch" style="display: none;">
                        <td colspan="3" class="text-center text-muted p-3 small">
                            <i class="bi bi-search me-1"></i> SKU tidak ditemukan.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const searchInput = document.getElementById('skuSearchInput');
        // Pastikan elemen ada sebelum menjalankan script
        if (searchInput) {
            searchInput.addEventListener('keyup', function (e) {
                const term = e.target.value.toLowerCase();
                const rows = document.querySelectorAll('.sku-row');
                let hasResult = false;

                rows.forEach(row => {
                    const skuText = row.querySelector('.sku-id-text').textContent.toLowerCase();
                    if (skuText.includes(term)) {
                        row.style.display = '';
                        hasResult = true;
                    } else {
                        row.style.display = 'none';
                    }
                });

                const noMatchMsg = document.getElementById('noSearchMatch');
                if (noMatchMsg) {
                    noMatchMsg.style.display = hasResult ? 'none' : '';
                }
            });
        }
    });
</script>