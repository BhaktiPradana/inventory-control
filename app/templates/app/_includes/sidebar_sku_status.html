<div class="card shadow-sm mb-4">
    <div class="card-header bg-dark text-white">
        <h3 class="h6 mb-0">SKU History</h3>
    </div>

    <div class="p-2 bg-light border-bottom">
        <input type="text" id="skuSearchInput" class="form-control form-control-sm" placeholder="Cari SKU ID..." autocomplete="off">
    </div>
    <div class="card-body p-0">
        <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
            <table class="table table-striped table-hover table-sm mb-0">
                <thead class="table-light">
                    <tr>
                        <th>SKU ID</th>
                        <th>Teknisi</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="skuTableBody">
                    {% for sku in sidebar_skus_under_tech %}
                    <tr class="sku-row">
                        <td>
                            <a href="#"
                               class="text-decoration-none fw-bold sku-id-text"
                               data-bs-toggle="modal"
                               data-bs-target="#skuHistoryModal"
                               data-sku-id="{{ sku.id }}">
                                {{ sku.sku_id }} <i class="bi bi-search ms-1" style="font-size: 0.8rem;"></i>
                            </a>
                        </td>
                        <td>{{ sku.assigned_technician.username }}</td>
                        <td>
                            <span class="badge
                                {% if sku.status == 'QC' %} bg-warning text-dark
                                {% elif sku.status == 'QC_PENDING' %} bg-info text-dark
                                {% elif sku.status == 'AWAITING_INSTALL' %} bg-primary
                                {% elif sku.status == 'PENDING_FINAL_CHECK' %} bg-info text-dark
                                {% else %} bg-secondary {% endif %}">
                                {{ sku.get_status_display }}
                            </span>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3" class="text-center text-muted p-3">
                            Tidak ada SKU yang sedang diproses.
                        </td>
                    </tr>
                    {% endfor %}
                    <tr id="noSearchMatch" style="display: none;">
                        <td colspan="3" class="text-center text-muted p-3 small">
                            SKU tidak ditemukan.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const searchInput = document.getElementById('skuSearchInput');
        // Pastikan elemen ada sebelum menjalankan script
        if (searchInput) {
            searchInput.addEventListener('keyup', function (e) {
                const term = e.target.value.toLowerCase();
                const rows = document.querySelectorAll('.sku-row');
                let hasResult = false;

                rows.forEach(row => {
                    const skuText = row.querySelector('.sku-id-text').textContent.toLowerCase();
                    if (skuText.includes(term)) {
                        row.style.display = '';
                        hasResult = true;
                    } else {
                        row.style.display = 'none';
                    }
                });

                const noMatchMsg = document.getElementById('noSearchMatch');
                if (noMatchMsg) {
                    noMatchMsg.style.display = hasResult ? 'none' : '';
                }
            });
        }
    });
</script>