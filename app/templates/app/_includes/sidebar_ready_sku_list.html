<div class="card card-glossy shadow-lg mt-4">
    <div class="card-header card-header-professional">
        <h3 class="h6 mb-0"><i class="bi bi-box-seam me-2"></i> List SKU Siap Jual</h3>
    </div>

    <ul class="nav nav-tabs nav-fill border-bottom-0" id="readySkuTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active fw-bold border-0" id="gudang-tab" data-bs-toggle="tab" data-bs-target="#gudang-tab-pane" type="button" role="tab" aria-controls="gudang-tab-pane" aria-selected="true">
                <i class="bi bi-warehouse me-1"></i> Ready Gudang
                <span class="badge bg-primary rounded-pill ms-1">
                    {{ ready_skus_list.count|default:0 }}
                </span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link fw-bold border-0" id="toko-tab" data-bs-toggle="tab" data-bs-target="#toko-tab-pane" type="button" role="tab" aria-controls="toko-tab-pane" aria-selected="false">
                <i class="bi bi-shop me-1"></i> Ready Store
                <span class="badge bg-info text-dark rounded-pill ms-1">
                    {{ shop_skus_list.count|default:0 }}
                </span>
            </button>
        </li>
    </ul>

    <div class="p-2 bg-light border-bottom">
        <div class="input-group input-group-sm">
            <span class="input-group-text bg-white border-end-0"><i class="bi bi-search"></i></span>
            <input type="text" id="readySkuSearchInput" class="form-control border-start-0" placeholder="Cari SKU Ready/Store..." autocomplete="off">
        </div>
    </div>

    <div class="tab-content" id="readySkuTabContent">

        <div class="tab-pane fade show active" id="gudang-tab-pane" role="tabpanel" aria-labelledby="gudang-tab" tabindex="0">
            <div style="max-height: 300px; overflow-y: auto;">
                <ul class="list-group list-group-flush">
                    {% for sku in ready_skus_list %}
                    <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center py-2 ready-sku-item">
                        <a href="#"
                           class="text-decoration-none fw-bold text-dark sku-id-text flex-grow-1 me-2"
                           data-bs-toggle="modal"
                           data-bs-target="#skuHistoryModal"
                           data-sku-id="{{ sku.id }}"
                           style="font-size: 0.9em;">
                            <i class="bi bi-tag me-1 text-primary"></i> {{ sku.sku_id }}
                        </a>
                        <span class="small text-end flex-shrink-0">
                            <span class="text-muted d-block text-truncate" style="font-size: 0.8em; max-width: 100px;">{{ sku.name|default:"-"|truncatechars:15 }}</span>
                            <a href="#" class="badge bg-light text-primary border border-primary-subtle"
                               data-bs-toggle="modal" data-bs-target="#skuHistoryModal" data-sku-id="{{ sku.id }}">
                                <i class="bi bi-search" style="font-size: 0.8rem;"></i> Detail
                            </a>
                        </span>
                    </li>
                    {% empty %}
                    <li class="list-group-item text-center text-muted p-3">
                        <i class="bi bi-info-circle me-1"></i> Tidak ada SKU Ready di Gudang.
                    </li>
                    {% endfor %}
                    <li class="list-group-item text-center text-muted p-3 no-gudang-match" style="display: none;">
                        <i class="bi bi-search me-1"></i> SKU tidak ditemukan.
                    </li>
                </ul>
            </div>
        </div>

        <div class="tab-pane fade" id="toko-tab-pane" role="tabpanel" aria-labelledby="toko-tab" tabindex="0">
            <div style="max-height: 300px; overflow-y: auto;">
                <ul class="list-group list-group-flush">
                    {% for sku in shop_skus_list %}
                    <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center py-2 ready-sku-item">
                        <a href="#"
                           class="text-decoration-none fw-bold text-dark sku-id-text flex-grow-1 me-2"
                           data-bs-toggle="modal"
                           data-bs-target="#skuHistoryModal"
                           data-sku-id="{{ sku.id }}"
                           style="font-size: 0.9em;">
                            <i class="bi bi-tag me-1 text-info"></i> {{ sku.sku_id }}
                        </a>
                        <span class="small text-end flex-shrink-0">
                            <span class="text-muted d-block text-truncate" style="font-size: 0.8em; max-width: 100px;">{{ sku.name|default:"-"|truncatechars:15 }}</span>
                            <a href="#" class="badge bg-light text-info border border-info-subtle"
                               data-bs-toggle="modal" data-bs-target="#skuHistoryModal" data-sku-id="{{ sku.id }}">
                                <i class="bi bi-search" style="font-size: 0.8rem;"></i> Detail
                            </a>
                        </span>
                    </li>
                    {% empty %}
                    <li class="list-group-item text-center text-muted p-3">
                        <i class="bi bi-info-circle me-1"></i> Tidak ada SKU Ready di Store.
                    </li>
                    {% endfor %}
                    <li class="list-group-item text-center text-muted p-3 no-toko-match" style="display: none;">
                        <i class="bi bi-search me-1"></i> SKU tidak ditemukan.
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const readySearchInput = document.getElementById('readySkuSearchInput');

        if (readySearchInput) {
            readySearchInput.addEventListener('keyup', function (e) {
                const term = e.target.value.toLowerCase();

                // --- Filter Tab Gudang ---
                const gudangRows = document.querySelectorAll('#gudang-tab-pane .ready-sku-item');
                let hasGudangResult = false;
                gudangRows.forEach(row => {
                    const skuText = row.querySelector('.sku-id-text').textContent.toLowerCase();
                    if (skuText.includes(term)) {
                        row.style.display = '';
                        hasGudangResult = true;
                    } else {
                        row.style.display = 'none';
                    }
                });
                const noGudangMsg = document.querySelector('#gudang-tab-pane .no-gudang-match');
                if (noGudangMsg) {
                    noGudangMsg.style.display = hasGudangResult ? 'none' : '';
                }

                // --- Filter Tab Toko ---
                const tokoRows = document.querySelectorAll('#toko-tab-pane .ready-sku-item');
                let hasTokoResult = false;
                tokoRows.forEach(row => {
                    const skuText = row.querySelector('.sku-id-text').textContent.toLowerCase();
                    if (skuText.includes(term)) {
                        row.style.display = '';
                        hasTokoResult = true;
                    } else {
                        row.style.display = 'none';
                    }
                });
                const noTokoMsg = document.querySelector('#toko-tab-pane .no-toko-match');
                if (noTokoMsg) {
                    noTokoMsg.style.display = hasTokoResult ? 'none' : '';
                }
            });
        }
    });
</script>